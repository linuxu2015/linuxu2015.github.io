<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="linuxu's blog">
<meta property="og:url" content="https://www.linuxu.top/index.html">
<meta property="og:site_name" content="linuxu's blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linuxu's blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.linuxu.top/"/>





  <title> linuxu's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">linuxu's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2018/03/21/centos6搭建openvpn/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/21/centos6搭建openvpn/" itemprop="url">
                  centos6搭建openvpn
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-21T15:21:31+08:00">
                2018-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/03/21/centos6搭建openvpn/" class="leancloud_visitors" data-flag-title="centos6搭建openvpn">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <hr>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/21/centos6搭建openvpn/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/08/16/hive整合本地hdfs文件/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/16/hive整合本地hdfs文件/" itemprop="url">
                  hive整合本地hdfs文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-16T11:28:21+08:00">
                2017-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/16/hive整合本地hdfs文件/" class="leancloud_visitors" data-flag-title="hive整合本地hdfs文件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>hive通过整合本地的hdfs文件，实现通过hive的sql语句查询hdfs文件中的内容</p>
<h3 id="查看待整合文件结构"><a href="#查看待整合文件结构" class="headerlink" title="查看待整合文件结构"></a>查看待整合文件结构</h3><p>注意：<em>导入到hive之后之前的文件会被删除</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@node2 ~]# hadoop dfs -cat   /data/traffic/traffic/oneM/oneM/20121030084631.txt | less</div><div class="line">DEPRECATED: Use of this script to execute hdfs command is deprecated.</div><div class="line">Instead use the hdfs command for it.</div><div class="line"></div><div class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0</div><div class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0</div><div class="line"></div><div class="line">155481,4,1,20121030090100,116.4536819,39.9185066,21,276,1</div><div class="line">453302,4,1,20121030090103,116.3347778,39.9956779,38,86,1</div><div class="line">194143,4,1,20121030090103,116.3319168,39.9371033,52,262,1</div><div class="line">020844,4,1,20121030090103,116.4533463,39.9221268,21,282,1</div><div class="line">100194,4,0,20121030090103,116.4551239,39.8972321,34,182,1</div><div class="line">214520,4,1,20121030090059,116.5295029,39.8384209,0,236,1</div><div class="line">164586,4,2,20121030090100,116.5062637,40.0107384,0,210,1</div><div class="line">564442,4,1,20121030090101,116.4839020,39.8848534,8,358,1</div></pre></td></tr></table></figure>
<p>可以看出一共有9个字段并且每个字段按照‘,’分隔的，所以创建hive表时要按照这个结构创建</p>
<h3 id="创建hive表"><a href="#创建hive表" class="headerlink" title="创建hive表"></a>创建hive表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create table wyp (a string, b string,c string, d string, e string,f string, g string,h string,i string) ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;,&apos; STORED AS TEXTFILE;</div></pre></td></tr></table></figure>
<p>这里的字段分隔也是“,”，这样才能对应起来</p>
<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hive&gt; load data inpath &apos;/data/traffic/traffic/oneM/oneM/20121030084631.txt&apos; into table wyp;</div></pre></td></tr></table></figure>
<h3 id="查看导入后的数据"><a href="#查看导入后的数据" class="headerlink" title="查看导入后的数据"></a>查看导入后的数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">hive&gt; select * from wyp limit 10;</div><div class="line">OK</div><div class="line">174956  4       1       20121030085921  116.2682571     39.8998299      0       0       1</div><div class="line">431090  4       0       20121030085920  116.4019241     39.8995934      2       166     1</div><div class="line">194101  4       1       20121030085921  116.5357971     39.9404030      43      256     1</div><div class="line">101694  4       1       20121030085921  116.4838181     39.9389687      30      358     1</div><div class="line">199294  4       1       20121030085921  116.2634735     39.9229469      19      88      1</div><div class="line">581047  4       0       20121030085917  116.1321182     39.8878632      80      262     1</div><div class="line">492261  4       1       20121030085917  116.2701797     39.8784409      84      350     1</div><div class="line">214266  4       1       20121030085920  116.3471146     39.9179916      0       284     1</div><div class="line">164769  1       1       20121030085921  116.4619980     39.9930725      17      152     1</div><div class="line">Time taken: 1.492 seconds, Fetched: 10 row(s)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/08/15/kafka增加节点后增加topic分区/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/15/kafka增加节点后增加topic分区/" itemprop="url">
                  kafka增加节点后增加topic分区
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-15T15:50:02+08:00">
                2017-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/15/kafka增加节点后增加topic分区/" class="leancloud_visitors" data-flag-title="kafka增加节点后增加topic分区">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="添加kafka节点"><a href="#添加kafka节点" class="headerlink" title="添加kafka节点"></a>添加kafka节点</h2><h3 id="交换机配置"><a href="#交换机配置" class="headerlink" title="交换机配置"></a>交换机配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">enable</div><div class="line">configure terminal</div><div class="line">interface port kafka机器光口</div><div class="line">关闭lacp</div><div class="line">lacp mode off</div><div class="line">把eth6划分到vlan 233，eth7划分到vlan49</div><div class="line">保存 write</div></pre></td></tr></table></figure>
<h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">删除/etc/sysconfig/network-scripts/ifcfg-bond0</div><div class="line">删除/etc/rc.local文件中bond以及route相关（最后3行）</div><div class="line">重新配置网络，eth6继续沿用233的ip地址，eth7使用申请的公网的ip地址</div><div class="line">重启机器</div></pre></td></tr></table></figure>
<h2 id="添加节点后分区"><a href="#添加节点后分区" class="headerlink" title="添加节点后分区"></a>添加节点后分区</h2><p>查看topic分布情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@node1 bin]<span class="comment"># ./kafka-topics.sh --zookeeper node2:2181 --topic bj_traffic --describe      </span></div><div class="line">Topic:bj_traffic        PartitionCount:8        ReplicationFactor:2     Configs:</div><div class="line">Topic: bj_traffic       Partition: 0    Leader: 1002    Replicas: 1002,1003     Isr: 1003,1002</div><div class="line">Topic: bj_traffic       Partition: 1    Leader: 1003    Replicas: 1003,1005     Isr: 1005,1003</div><div class="line">Topic: bj_traffic       Partition: 2    Leader: 1005    Replicas: 1005,1001     Isr: 1005,1001</div><div class="line">Topic: bj_traffic       Partition: 3    Leader: 1001    Replicas: 1001,1002     Isr: 1001,1002</div><div class="line">Topic: bj_traffic       Partition: 4    Leader: 1002    Replicas: 1002,1005     Isr: 1002,1005</div><div class="line">Topic: bj_traffic       Partition: 5    Leader: 1003    Replicas: 1003,1001     Isr: 1003,1001</div><div class="line">Topic: bj_traffic       Partition: 6    Leader: 1005    Replicas: 1005,1002     Isr: 1005,1002</div><div class="line">Topic: bj_traffic       Partition: 7    Leader: 1001    Replicas: 1001,1003     Isr: 1003,1001</div></pre></td></tr></table></figure></p>
<p>以上可知，topic bj_traffic有8个分区，2个副本，四个节点分别为1001，1002，1003，1005<br>重新分布分区<br>使用Kafka自带的kafka-reassign-partitions.sh工具来重新分布分区。该工具有三种使用模式：</p>
<p>　　1、generate模式，给定需要重新分配的Topic，自动生成reassign plan（并不执行）（可根据自动生成的plan自定义分区分布）<br>　　2、execute模式，根据指定的reassign plan重新分配Partition<br>　　3、verify模式，验证重新分配Partition是否成功</p>
<p>借助kafka-reassign-partitions.sh工具生成reassign plan，不过我们先得按照要求定义一个文件，里面说明哪些topic需要重新分区，文件内容如下：</p>
<p>[iteblog@www.iteblog.com ~]$ cat topics-to-move.json<br>{“topics”: [{“topic”: “bg_traffic”}],<br> “version”:1<br>}<br>然后使用kafka-reassign-partitions.sh工具生成reassign plan<br>命令会打出当前分区分布以及reassign之后的分区分布，把生成的新的分区分布保存为一个json文件,执行这个result.json文件</p>
<p>[root@node1 bin]# ./kafka-reassign-partitions.sh –zookeeper node2:2181 –reassignment-json-file result.json –execute</p>
<p>Current partition replica assignment</p>
<p>{“version”:1,”partitions”:[{“topic”:”bj_traffic”,”partition”:4,”replicas”:[1002,1005]},{“topic”:”bj_traffic”,”partition”:3,”replicas”:[1001,1002]},{“topic”:”bj_traffic”,”partition”:5,”replicas”:[1003,1001]},{“topic”:”bj_traffic”,”partition”:6,”replicas”:[1005,1002]},{“topic”:”bj_traffic”,”partition”:7,”replicas”:[1001,1003]},{“topic”:”bj_traffic”,”partition”:1,”replicas”:[1003,1005]},{“topic”:”bj_traffic”,”partition”:0,”replicas”:[1002,1003]},{“topic”:”bj_traffic”,”partition”:2,”replicas”:[1005,1001]}]}</p>
<p>Save this to use as the –reassignment-json-file option during rollback</p>
<p>Successfully started reassignment of partitions {“version”:1,”partitions”:[{“topic”:”bj_traffic”,”partition”:6,”replicas”:[1001,1005]},{“topic”:”bj_traffic”,”partition”:2,”replicas”:[1001,1003]},{“topic”:”bj_traffic”,”partition”:7,”replicas”:[1002,1001]},{“topic”:”bj_traffic”,”partition”:3,”replicas”:[1002,1005]},{“topic”:”bj_traffic”,”partition”:1,”replicas”:[1005,1002]},{“topic”:”bj_traffic”,”partition”:0,”replicas”:[1003,1001]},{“topic”:”bj_traffic”,”partition”:4,”replicas”:[1003,1002]},{“topic”:”bj_traffic”,”partition”:5,”replicas”:[1005,1003]}]}</p>
<h3 id="验证重新分布进度"><a href="#验证重新分布进度" class="headerlink" title="验证重新分布进度"></a>验证重新分布进度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@node1 bin]# ./kafka-reassign-partitions.sh --zookeeper node2:2181 --reassignment-json-file result.json --verify</div><div class="line">Status of partition reassignment:</div><div class="line">Reassignment of partition [bj_traffic,6] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,2] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,7] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,3] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,1] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,0] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,4] completed successfully</div><div class="line">Reassignment of partition [bj_traffic,5] completed successfully</div></pre></td></tr></table></figure>
<h2 id="增加已有topic的分区"><a href="#增加已有topic的分区" class="headerlink" title="增加已有topic的分区"></a>增加已有topic的分区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@node1 bin]# ./kafka-topics.sh --zookeeper node2:2181 --alter --partitions 9 --topic bj_traffic </div><div class="line"></div><div class="line">WARNING: If partitions are increased for a topic that has a key, the partition logic or ordering of the messages will be affected</div><div class="line"></div><div class="line">Adding partitions succeeded!</div><div class="line"></div><div class="line">[root@node1 bin]# ./kafka-topics.sh --zookeeper node2:2181 --topic bj_traffic --describe            </div><div class="line"></div><div class="line">Topic:bj_traffic        PartitionCount:9        ReplicationFactor:2     Configs:</div><div class="line">Topic: bj_traffic       Partition: 0    Leader: 1003    Replicas: 1003,1001     Isr: 1003,1001</div><div class="line">Topic: bj_traffic       Partition: 1    Leader: 1005    Replicas: 1005,1002     Isr: 1005,1002</div><div class="line">Topic: bj_traffic       Partition: 2    Leader: 1001    Replicas: 1001,1003     Isr: 1001,1003</div><div class="line">Topic: bj_traffic       Partition: 3    Leader: 1002    Replicas: 1002,1005     Isr: 1002,1005</div><div class="line">Topic: bj_traffic       Partition: 4    Leader: 1002    Replicas: 1003,1002     Isr: 1002,1003</div><div class="line">Topic: bj_traffic       Partition: 5    Leader: 1003    Replicas: 1005,1003     Isr: 1003,1005</div><div class="line">Topic: bj_traffic       Partition: 6    Leader: 1005    Replicas: 1001,1005     Isr: 1005,1001</div><div class="line">Topic: bj_traffic       Partition: 7    Leader: 1001    Replicas: 1002,1001     Isr: 1001,1002</div><div class="line">Topic: bj_traffic       Partition: 8    Leader: 1003    Replicas: 1003,1005     Isr: 1003,1005</div></pre></td></tr></table></figure>
<p>从上面的输出可以看出已经有9个分区了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/08/08/phoenix与hbase整合/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/08/phoenix与hbase整合/" itemprop="url">
                  phoenix与hbase整合
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-08T14:35:23+08:00">
                2017-08-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/08/phoenix与hbase整合/" class="leancloud_visitors" data-flag-title="phoenix与hbase整合">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="phoenix与hive的整合"><a href="#phoenix与hive的整合" class="headerlink" title="phoenix与hive的整合"></a>phoenix与hive的整合</h2><p>资料:<br><a href="http://phoenix.apache.org/hive_storage_handler.html" target="_blank" rel="external">http://phoenix.apache.org/hive_storage_handler.html</a><br><a href="https://my.oschina.net/Allenbigdata/blog/783894" target="_blank" rel="external">https://my.oschina.net/Allenbigdata/blog/783894</a><br>这两个资料的phoenix都是4.8版本的，而我这里的是4.7版本的，按照这个进行操作均不成功。<br>最后执行了一条:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -sv /usr/hdp/current/phoenix-client/phoenix-client.jar /usr/hdp/current/hive-server2/lib/phoenix-client.jar</div></pre></td></tr></table></figure></p>
<p>然后再执行建表语句就成功了，无语……研究了一天最后一条命令搞定了，期间各种替换jar，各种改配置文件……<br>建表语句:<br>Create INTERNAL Table<br>For INTERNAL tables, Hive manages the lifecycle of the table and data. When a Hive table is created, a corresponding Phoenix table is also created. Once the Hive table is dropped, the Phoenix table is also deleted.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">create table phoenix_table (</div><div class="line">	  s1 string,</div><div class="line">	  i1 int,</div><div class="line">	  f1 float,</div><div class="line">	  d1 double</div><div class="line">	)</div><div class="line">	STORED BY &apos;org.apache.phoenix.hive.PhoenixStorageHandler&apos;</div><div class="line">	TBLPROPERTIES (</div><div class="line">	  &quot;phoenix.table.name&quot; = &quot;phoenix_table&quot;,</div><div class="line">	  &quot;phoenix.zookeeper.quorum&quot; = &quot;localhost&quot;,</div><div class="line">	  &quot;phoenix.zookeeper.znode.parent&quot; = &quot;/hbase&quot;,</div><div class="line">	  &quot;phoenix.zookeeper.client.port&quot; = &quot;2181&quot;,</div><div class="line">	  &quot;phoenix.rowkeys&quot; = &quot;s1, i1&quot;,</div><div class="line">	  &quot;phoenix.column.mapping&quot; = &quot;s1:s1, i1:i1, f1:f1, d1:d1&quot;,</div><div class="line">	  &quot;phoenix.table.options&quot; = &quot;SALT_BUCKETS=10, DATA_BLOCK_ENCODING=&apos;DIFF&apos;&quot;</div><div class="line">	);</div></pre></td></tr></table></figure></p>
<p>Create EXTERNAL Table<br>For EXTERNAL tables, Hive works with an existing Phoenix table and manages only Hive metadata. Dropping an EXTERNAL table from Hive deletes only Hive metadata but does not delete the Phoenix table.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">create external table ext_table (</div><div class="line">  i1 int,</div><div class="line">  s1 string,</div><div class="line">  f1 float,</div><div class="line">  d1 decimal</div><div class="line">)</div><div class="line">STORED BY &apos;org.apache.phoenix.hive.PhoenixStorageHandler&apos;</div><div class="line">TBLPROPERTIES (</div><div class="line">  &quot;phoenix.table.name&quot; = &quot;ext_table&quot;,</div><div class="line">  &quot;phoenix.zookeeper.quorum&quot; = &quot;localhost&quot;,</div><div class="line">  &quot;phoenix.zookeeper.znode.parent&quot; = &quot;/hbase&quot;,</div><div class="line">  &quot;phoenix.zookeeper.client.port&quot; = &quot;2181&quot;,</div><div class="line">  &quot;phoenix.rowkeys&quot; = &quot;i1&quot;,</div><div class="line">  &quot;phoenix.column.mapping&quot; = &quot;i1:i1, s1:s1, f1:f1, d1:d1&quot;</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>Properties</p>
<ol>
<li>phoenix.zookeeper.quorum<br>Specifies the ZooKeeper quorum for HBase<br>Default: localhost</li>
<li>phoenix.zookeeper.znode.parent<br>Specifies the ZooKeeper parent node for HBase<br>Default: /hbase</li>
<li>phoenix.zookeeper.client.port<br>Specifies the ZooKeeper port<br>Default: 2181</li>
<li>phoenix.rowkeys<br>The list of columns to be the primary key in a Phoenix table<br>Required</li>
<li>phoenix.column.mapping<br>Mappings between column names for Hive and Phoenix. See Limitations for details.</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/08/07/ambari-catalog不存在无法启动错误/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/07/ambari-catalog不存在无法启动错误/" itemprop="url">
                  ambari_catalog不存在无法启动错误
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-07T21:27:51+08:00">
                2017-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/07/ambari-catalog不存在无法启动错误/" class="leancloud_visitors" data-flag-title="ambari_catalog不存在无法启动错误">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p><strong>Caused by: org.apache.hadoop.hbase.TableNotFoundException: SYSTEM.CATALOG</strong></p>
<h3 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a>问题描述：</h3><p>ambari界面一直有alert的报警，具体就是连接不到6188端口，而6188端口就是ambari-metric-collect的监听端口，去服务器查看发现6188端口没有起来，去日志查看发现报如下错误</p>
<pre><code>2017-07-20 01:00:16,489 INFO org.apache.hadoop.metrics2.impl.MetricsSystemImpl: Stopping phoenix metrics system...
2017-07-20 01:00:16,489 INFO org.apache.hadoop.metrics2.impl.MetricsSystemImpl: phoenix metrics system stopped.
2017-07-20 01:00:16,489 INFO org.apache.hadoop.metrics2.impl.MetricsSystemImpl: phoenix metrics system shutdown complete.
2017-07-20 01:00:16,489 INFO org.apache.hadoop.yarn.server.applicationhistoryservice.ApplicationHistoryManagerImpl: Stopping ApplicationHistory
2017-07-20 01:00:16,489 FATAL org.apache.hadoop.yarn.server.applicationhistoryservice.ApplicationHistoryServer: Error starting ApplicationHistoryServer
org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.MetricsSystemInitializationException: Error creating Metrics Schema in HBase using Phoenix.
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.PhoenixHBaseAccessor.initMetricSchema(PhoenixHBaseAccessor.java:470)
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.HBaseTimelineMetricStore.initializeSubsystem(HBaseTimelineMetricStore.java:94)
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.HBaseTimelineMetricStore.serviceInit(HBaseTimelineMetricStore.java:86)
at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)
at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)
at org.apache.hadoop.yarn.server.applicationhistoryservice.ApplicationHistoryServer.serviceInit(ApplicationHistoryServer.java:84)
at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)
at org.apache.hadoop.yarn.server.applicationhistoryservice.ApplicationHistoryServer.launchAppHistoryServer(ApplicationHistoryServer.java:137)
at org.apache.hadoop.yarn.server.applicationhistoryservice.ApplicationHistoryServer.main(ApplicationHistoryServer.java:147)
Caused by: org.apache.phoenix.exception.PhoenixIOException: SYSTEM.CATALOG
at org.apache.phoenix.util.ServerUtil.parseServerException(ServerUtil.java:111)
at org.apache.phoenix.query.ConnectionQueryServicesImpl.metaDataCoprocessorExec(ConnectionQueryServicesImpl.java:1292)
at org.apache.phoenix.query.ConnectionQueryServicesImpl.metaDataCoprocessorExec(ConnectionQueryServicesImpl.java:1257)
at org.apache.phoenix.query.ConnectionQueryServicesImpl.createTable(ConnectionQueryServicesImpl.java:1453)
at org.apache.phoenix.schema.MetaDataClient.createTableInternal(MetaDataClient.java:2180)
at org.apache.phoenix.schema.MetaDataClient.createTable(MetaDataClient.java:865)
at org.apache.phoenix.compile.CreateTableCompiler$2.execute(CreateTableCompiler.java:194)
at org.apache.phoenix.jdbc.PhoenixStatement$2.call(PhoenixStatement.java:343)
at org.apache.phoenix.jdbc.PhoenixStatement$2.call(PhoenixStatement.java:331)
at org.apache.phoenix.call.CallRunner.run(CallRunner.java:53)
at org.apache.phoenix.jdbc.PhoenixStatement.executeMutation(PhoenixStatement.java:329)
at org.apache.phoenix.jdbc.PhoenixStatement.executeUpdate(PhoenixStatement.java:1421)
at org.apache.phoenix.query.ConnectionQueryServicesImpl$13.call(ConnectionQueryServicesImpl.java:2378)
at org.apache.phoenix.query.ConnectionQueryServicesImpl$13.call(ConnectionQueryServicesImpl.java:2327)
at org.apache.phoenix.util.PhoenixContextExecutor.call(PhoenixContextExecutor.java:78)
at org.apache.phoenix.query.ConnectionQueryServicesImpl.init(ConnectionQueryServicesImpl.java:2327)
at org.apache.phoenix.jdbc.PhoenixDriver.getConnectionQueryServices(PhoenixDriver.java:233)
at org.apache.phoenix.jdbc.PhoenixEmbeddedDriver.createConnection(PhoenixEmbeddedDriver.java:142)
at org.apache.phoenix.jdbc.PhoenixDriver.connect(PhoenixDriver.java:202)
at java.sql.DriverManager.getConnection(DriverManager.java:664)
at java.sql.DriverManager.getConnection(DriverManager.java:270)
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.query.DefaultPhoenixDataSource.getConnection(DefaultPhoenixDataSource.java:82)
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.PhoenixHBaseAccessor.getConnection(PhoenixHBaseAccessor.java:376)
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.PhoenixHBaseAccessor.getConnectionRetryingOnException(PhoenixHBaseAccessor.java:354)
at org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.PhoenixHBaseAccessor.initMetricSchema(PhoenixHBaseAccessor.java:398)
... 8 more
</code></pre><h3 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h3><p>Shut down Ambari Monitors, and Collector via Ambari<br>Cleared out the /var/lib/ambari-metrics-collector dir for fresh restart<br>From Ambari -&gt; Ambari Metrics -&gt; Config -&gt; Advanced ams-hbase-site get the hbase.rootdir and hbase-tmp directory</p>
<p><strong>hbase.rootdir</strong></p>
<p><strong>hbase.tmp.dir</strong></p>
<p>Delete or Move the hbase-tmp and hbase.rootdir directories to an archive folder<br>Started AMS.<br>All services will came online and graphs started to display, after a few minutes</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/08/06/java学习记录-if-switch语句/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/06/java学习记录-if-switch语句/" itemprop="url">
                  java学习记录-if-switch语句
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-06T23:16:23+08:00">
                2017-08-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/06/java学习记录-if-switch语句/" class="leancloud_visitors" data-flag-title="java学习记录-if-switch语句">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p>记录java学习的练习程序，主要作为语法的熟悉备忘以及一些知识点。</p>
<h2 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h2><p><img src="http://7xj1qf.com1.z0.glb.clouddn.com/xu3kuwas6h0he5mm7re9r25yd5.png" alt=""><br><img src="http://7xj1qf.com1.z0.glb.clouddn.com/hus8rj1o1gk9methirulepyl23.png" alt=""></p>
<h2 id="if语句练习1"><a href="#if语句练习1" class="headerlink" title="if语句练习1"></a>if语句练习1</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> age = <span class="number">24</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (age&gt;<span class="number">20</span>)&#123;</div><div class="line">            System.out.print(<span class="string">"grow up"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            System.out.print(<span class="string">"little guy"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> age = <span class="number">10</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (age&gt;<span class="number">24</span>)&#123;</div><div class="line">            System.out.print(<span class="string">"ddaxue"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (age &gt;<span class="number">20</span>)&#123;</div><div class="line">            System.out.print(<span class="string">"gaozhong"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (age &gt;<span class="number">16</span>)&#123;</div><div class="line">            System.out.print(<span class="string">"chuzhong"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (age &gt; <span class="number">13</span>)&#123;</div><div class="line">            System.out.print(<span class="string">"xiaoxue"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            System.out.print(<span class="string">"meishangxue"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="if语句练习2"><a href="#if语句练习2" class="headerlink" title="if语句练习2"></a>if语句练习2</h2><p>键盘输入三个整数，num1,num2,num3排序输出从大到小<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</div><div class="line"></div><div class="line">        System.out.print(<span class="string">"num1="</span>);</div><div class="line">        <span class="keyword">int</span> num1 = s.nextInt();</div><div class="line"></div><div class="line">        System.out.print(<span class="string">"num2="</span>);</div><div class="line">        <span class="keyword">int</span> num2 = s.nextInt();</div><div class="line">        System.out.print(<span class="string">"num3="</span>);</div><div class="line">        <span class="keyword">int</span> num3 = s.nextInt();</div><div class="line">       </div><div class="line"></div><div class="line">        <span class="keyword">if</span> (num1&lt;num2)&#123;</div><div class="line">            <span class="keyword">if</span> (num3&lt;num1)&#123;</div><div class="line">                System.out.print(num3 + <span class="string">","</span>+num1+<span class="string">","</span>+num2);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (num3&gt;num2)&#123;</div><div class="line">                System.out.print(num1 + <span class="string">","</span>+num2+<span class="string">","</span>+num3);</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                System.out.print(num1 + <span class="string">","</span>+num3+<span class="string">","</span>+num2);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//num1 &gt;= num2</span></div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (num3 &lt; num2)&#123;</div><div class="line">                System.out.print(num3 + <span class="string">","</span>+num2+<span class="string">","</span>+num1);</div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (num3 &gt; num1)&#123;</div><div class="line">                System.out.print(num2 + <span class="string">","</span>+num1+<span class="string">","</span>+num3);</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                System.out.print(num2 + <span class="string">","</span>+num3+<span class="string">","</span>+num1);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="switch练习1"><a href="#switch练习1" class="headerlink" title="switch练习1"></a>switch练习1</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSwitch</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String [] args)</span></span>&#123;</div><div class="line">        <span class="keyword">int</span> a = <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> x = <span class="number">100</span>;</div><div class="line">        <span class="keyword">switch</span> (a)&#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                x+=<span class="number">5</span>;</div><div class="line">                System.out.print(<span class="string">"result="</span>+x);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">                x+=<span class="number">10</span>;</div><div class="line">                System.out.print(<span class="string">"result="</span>+x);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">                x+=<span class="number">16</span>;</div><div class="line">                System.out.print(<span class="string">"result="</span>+x);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                x+=<span class="number">34</span>;</div><div class="line">                System.out.print(<span class="string">"result="</span>+x);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="switch练习2"><a href="#switch练习2" class="headerlink" title="switch练习2"></a>switch练习2</h2><p>键盘输入成绩，打印等级<br>>=90 A<br>90&gt;  &gt;=70 B<br>70&gt; &gt;=60 C<br>>60 D<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSwitch</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</div><div class="line">        System.out.print(<span class="string">"score="</span>);</div><div class="line">        <span class="keyword">int</span> score = s.nextInt();</div><div class="line">        <span class="keyword">if</span> (score &gt; <span class="number">100</span> || score &lt;<span class="number">0</span>)&#123;</div><div class="line">            System.out.print(<span class="string">"分数不合法"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">char</span> grade = <span class="string">' '</span>;</div><div class="line">            <span class="keyword">switch</span> (score / <span class="number">10</span>) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">10</span>:</div><div class="line">                    grade = <span class="string">'A'</span>;</div><div class="line">                    System.out.print(<span class="string">"A"</span>);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">9</span>:</div><div class="line">                    grade = <span class="string">'A'</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">8</span>:</div><div class="line">                    grade = <span class="string">'B'</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">7</span>:</div><div class="line">                    grade = <span class="string">'B'</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">                    grade = <span class="string">'C'</span>;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    grade = <span class="string">'D'</span>;</div><div class="line">            &#125;</div><div class="line">           System.out.print(<span class="string">"grade is "</span> + grade);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="switch练习3"><a href="#switch练习3" class="headerlink" title="switch练习3"></a>switch练习3</h2><p>输入月份和日期输出一年的第几天<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Scanner;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestSwitch</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span></span>&#123;</div><div class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</div><div class="line">        System.out.print(<span class="string">"mouth="</span>);</div><div class="line">        <span class="keyword">int</span> mouth = s.nextInt();</div><div class="line">        System.out.print(<span class="string">"day="</span>);</div><div class="line">        <span class="keyword">int</span> day = s.nextInt();</div><div class="line">        <span class="keyword">int</span> days = <span class="number">0</span>;</div><div class="line">        <span class="keyword">switch</span> (mouth)&#123;</div><div class="line">            <span class="keyword">case</span> <span class="number">12</span>:days += <span class="number">30</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">11</span>:days+=<span class="number">31</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">10</span>:days+=<span class="number">30</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">9</span>:days+=<span class="number">31</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">8</span>:days+=<span class="number">31</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">7</span>:days+=<span class="number">30</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">6</span>:days+=<span class="number">31</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">5</span>:days+=<span class="number">30</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">4</span>:days+=<span class="number">31</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">3</span>:days+=<span class="number">28</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">2</span>:days+=<span class="number">31</span>;</div><div class="line">            <span class="keyword">case</span> <span class="number">1</span>:days+=day;</div><div class="line">        &#125;</div><div class="line">        System.out.print(mouth + <span class="string">"月"</span> +day + <span class="string">"日是第"</span> +days+ <span class="string">"天"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/08/06/phoenix通过phoenix-query-server连接hbase/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/06/phoenix通过phoenix-query-server连接hbase/" itemprop="url">
                  phoenix通过phoenix query server连接hbase
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-06T17:55:58+08:00">
                2017-08-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/08/06/phoenix通过phoenix-query-server连接hbase/" class="leancloud_visitors" data-flag-title="phoenix通过phoenix query server连接hbase">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p>集群通过ambari安装phoenix query server，监听端口8765</p>
<h1 id="phoenix安装"><a href="#phoenix安装" class="headerlink" title="phoenix安装"></a>phoenix安装</h1><h2 id="下载phoenix二进制包"><a href="#下载phoenix二进制包" class="headerlink" title="下载phoenix二进制包"></a>下载phoenix二进制包</h2><p>注意对应hbase版本，实验环境版本如下</p>
<ol>
<li>hbase 1.1.2</li>
<li>phoenix 4.10</li>
</ol>
<h2 id="解压到-usr-local"><a href="#解压到-usr-local" class="headerlink" title="解压到/usr/local/"></a>解压到/usr/local/</h2><p>复制phoenix-4.10.0-HBase-1.1-client.jar phoenix-core-4.10.0-HBase-1.1.jar到hbase的lib目录下</p>
<h1 id="连接hbase"><a href="#连接hbase" class="headerlink" title="连接hbase"></a>连接hbase</h1><p>./bin/sqlline-thin.py <a href="http://phoenix_query_server:8765" target="_blank" rel="external">http://phoenix_query_server:8765</a></p>
<h2 id="通过sql操作hbase"><a href="#通过sql操作hbase" class="headerlink" title="通过sql操作hbase"></a>通过sql操作hbase</h2><p>进入Phoenix命令行，执行</p>
<pre><code>!tables
</code></pre><p>即可查看所有Hbase中的所有数据表。</p>
<h3 id="增删查改操作"><a href="#增删查改操作" class="headerlink" title="增删查改操作"></a>增删查改操作</h3><h4 id="创建表格示例："><a href="#创建表格示例：" class="headerlink" title="创建表格示例："></a>创建表格示例：</h4><pre><code>create table person(id varchar primary key, name varchar);
</code></pre><h4 id="插入数据示例："><a href="#插入数据示例：" class="headerlink" title="插入数据示例："></a>插入数据示例：</h4><pre><code>upsert into person values (&apos;111&apos;,&apos;jone&apos;);
</code></pre><p>这里的upsert既有插入也有更新的功能，兼SQL中的insert和update功能，更新时按主键更新。</p>
<h4 id="删除数据示例："><a href="#删除数据示例：" class="headerlink" title="删除数据示例："></a>删除数据示例：</h4><pre><code>delete from person where id=&apos;222&apos;;
</code></pre><h4 id="查询示例："><a href="#查询示例：" class="headerlink" title="查询示例："></a>查询示例：</h4><pre><code>select * from person;
</code></pre><p><strong>当前实验只能查询并且修改通过phoenix创建的表，之前存在以及通过其他方式创建的hbase无法查看以及修改</strong></p>
<h1 id="错误："><a href="#错误：" class="headerlink" title="错误："></a>错误：</h1><p>AvaticaClientRuntimeException: Remote driver error: RuntimeException: org.apache.phoenix.exception.PhoenixIOException: Table ‘SYSTEM.CATALOG’ was not found, got: PCB_ST_PHOTO. -PhoenixIOException: Table ‘SYSTEM.CATALOG’ was not found, got: PCB_ST_PHOTO. -TableNotFoundException: Table ‘SYSTEM.CATALOG’ was not found, got: PCB_ST_PHOTO.. Error -1 (00000) null</p>
<p>提示找不到SYSTEM.CATALOG表，这是phoenix第一次连接hbase时需要创建的表，找不到即没有创建成功。</p>
<p><strong>解决方法：</strong></p>
<pre><code>./hbase  clean --cleanZK
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/03/03/动态路由协议基础/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/03/动态路由协议基础/" itemprop="url">
                  动态路由协议基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-03T10:02:30+08:00">
                2017-03-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/03/03/动态路由协议基础/" class="leancloud_visitors" data-flag-title="动态路由协议基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>路由协议是路由器之间交互信息的一种语言，路由器之间通过路由协议共享网络状态和网络可达性的一些信息。路由器依靠动态路由协议来传播和收集路由选择信息。路由协议定义了一套路由器与邻接路由器通信时使用的规则。动态计算路由，适应网络变化，找出本地路由器到网络中其他网段的路由。</p>
</blockquote>
<h4 id="常见的动态路由协议："><a href="#常见的动态路由协议：" class="headerlink" title="常见的动态路由协议："></a>常见的动态路由协议：</h4><ul>
<li>RIP：Routing Information Protocol,路由信息协议</li>
<li>OSPF: Open shortest Path First,开放式最短路径优先</li>
<li>ISIS: Intermediate System to Intermediate System,中间系统到中间系统</li>
<li>BGP:Border Gateway Protocol,边界网关协议</li>
</ul>
<h4 id="自治系统（Autonomous-System）"><a href="#自治系统（Autonomous-System）" class="headerlink" title="自治系统（Autonomous System）"></a>自治系统（Autonomous System）</h4><p><img src="http://7pun1h.com1.z0.glb.clouddn.com/rlc1hnfciqu2f49a0k6wc87duz.png" alt=""><br>自治系统（AS    ）:由同一个技术管理机构管理，使用统一选路策略的一些路由器的集合。<br>自治系统内部的路由协议—-IGP:RIPv1/v2、OSPF、ISIS<br>自治系统之间的路由协议—-EGP:BGP</p>
<h4 id="动态路由协议的分类"><a href="#动态路由协议的分类" class="headerlink" title="动态路由协议的分类"></a>动态路由协议的分类</h4><h5 id="使用算法"><a href="#使用算法" class="headerlink" title="使用算法"></a>使用算法</h5><p>距离矢量路由协议</p>
<ul>
<li>基于距离矢量算法</li>
<li>RIPv1/v2、BGP<br>链路状态路由协议</li>
<li>基于SPF(Shortest Path First)</li>
<li>OSPF、ISIS<h5 id="目的地址类型"><a href="#目的地址类型" class="headerlink" title="目的地址类型"></a>目的地址类型</h5>单播路由协议（Unicast Routing Protocol）</li>
<li>目的地址为单播</li>
<li>RIP、OSPF、ISIS、BGP<br>组播路由协议（Multicast Routing Protocol）</li>
<li>目的地址为组播</li>
<li>PIM-SM、PIM-DM</li>
</ul>
<h4 id="衡量动态路由协议的一些性能指标"><a href="#衡量动态路由协议的一些性能指标" class="headerlink" title="衡量动态路由协议的一些性能指标"></a>衡量动态路由协议的一些性能指标</h4><ul>
<li>正确性<br> 能够正确找到最优的路由，且无自环。</li>
<li>快收敛<br> 当网络的拓扑发生变化之后，能够迅速在自治系统中作相应的路由改变</li>
<li>低开销<br> 协议自身的开销（内存、cpu、网络带宽）最小</li>
<li>安全性<br> 协议自身不易受攻击，有安全机制。</li>
<li>普适性<br>适应各种拓扑结构和规模的网络</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/02/22/hcna学习-1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/22/hcna学习-1/" itemprop="url">
                  hcna学习(1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-22T15:00:09+08:00">
                2017-02-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/02/22/hcna学习-1/" class="leancloud_visitors" data-flag-title="hcna学习(1)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p>刚开始进行学习hcna的相关知识，做个记录方便后面遇到问题的时候回来查看</p>
<p>配置telnet</p>
<p>拓扑图<br><img src="http://i.imgur.com/Y9DXOZ1.png" alt=""><br>配置R1的telnet功能，使用R2进行连接测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">user-interface vty 04 </div><div class="line">	authentication-mode aaa</div><div class="line">	user privilege level 3</div><div class="line">aaa</div><div class="line">	local-user admin password cipher huawei</div><div class="line">	local-user admin privilege level 3</div><div class="line">	local-user admin service0type telnet</div></pre></td></tr></table></figure></p>
<h4 id="配置stelnet"><a href="#配置stelnet" class="headerlink" title="配置stelnet"></a>配置stelnet</h4><p>配置R1的stelnet功能，使用R2进行连接测试(stelnet 在系统视图才有)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">system-view</div><div class="line">rsa local-key-pair create</div><div class="line">display rsa local-ley-pair public</div><div class="line">user-interface vty 04 </div><div class="line">	authentication-mode aaa</div><div class="line">	protocol inbound ssh</div><div class="line">aaa</div><div class="line">	local-user admin privilege level 3</div><div class="line">	local-user admin service-type ssh</div><div class="line">ssh user admin authentication-type password</div><div class="line">stelnet server enable</div><div class="line">display ssh user-information</div><div class="line">display ssh server status</div><div class="line">display ssh server session</div></pre></td></tr></table></figure></p>
<p>R2进行连接时需要执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh client first-time enable</div></pre></td></tr></table></figure></p>
<h4 id="ensp连接真实物理机与vmware虚拟机xp"><a href="#ensp连接真实物理机与vmware虚拟机xp" class="headerlink" title="ensp连接真实物理机与vmware虚拟机xp"></a>ensp连接真实物理机与vmware虚拟机xp</h4><p>拓扑图<br><img src="http://i.imgur.com/d00jZBP.png" alt=""><br>cloud1（vnet8）配置（不用在意虚拟网看后面的ip地址）<br><img src="http://i.imgur.com/sxQgmrb.png" alt=""><br>cloud2（vnet1）配置（不用在意虚拟网看后面的ip地址）<br><img src="http://i.imgur.com/9NJ34yW.png" alt=""><br>修改本地vnet1和vnet8的ip地址<br><img src="http://i.imgur.com/0srRpmC.png" alt=""><br>vnet8配置<br><img src="http://i.imgur.com/W3T1v7s.png" alt=""><br>vnet1配置<br><img src="http://i.imgur.com/UHc4tMJ.png" alt=""><br>现在真机ping路由器192.168.100.1和192.168.80.1都可以通了<br>下面配置虚拟机xp<br>因为cloud1连接到了vnet8,所以虚拟机也需要使用vnet8的虚拟网卡<br>给虚拟机配置上ip地址后，整个网络就可以互相ping通了<br><img src="http://i.imgur.com/M9f9Jss.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://www.linuxu.top/2017/02/20/基于nginx的开源监控软件nagios搭建/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="徐立宝">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="linuxu's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="linuxu's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/20/基于nginx的开源监控软件nagios搭建/" itemprop="url">
                  基于nginx的开源监控软件nagios搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-20T21:43:26+08:00">
                2017-02-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/02/20/基于nginx的开源监控软件nagios搭建/" class="leancloud_visitors" data-flag-title="基于nginx的开源监控软件nagios搭建">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<blockquote>
<p>nagios相比于zabbix是非常灵活的开源监控软件，但使用起来的门槛比zabbix要高，各种脚本的组合，不像zabbix基本的监控一个agent就搞定了。</p>
</blockquote>
<h2 id="安装包的下载"><a href="#安装包的下载" class="headerlink" title="安装包的下载"></a>安装包的下载</h2><p>源码包下载地址：<a href="https://www.nagios.org/downloads/nagios-core/" title="点我下载" target="_blank" rel="external">https://www.nagios.org/downloads/nagios-core/</a><br>插件下载地址：<a href="http://nagios-plugins.org/download/nagios-plugins-2.1.2.tar.gz" title="点我下载插件" target="_blank" rel="external">http://nagios-plugins.org/download/nagios-plugins-2.1.2.tar.gz</a></p>
<h2 id="安装环境依赖"><a href="#安装环境依赖" class="headerlink" title="安装环境依赖"></a>安装环境依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install gcc glibc glibc-common gd gd-devel xinetd openssl-devel unzip autoconf automake wget git  vim lrzsz perl perl-devel fcgi-devel fcgi</div></pre></td></tr></table></figure>
<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><h3 id="创建nagios用户"><a href="#创建nagios用户" class="headerlink" title="创建nagios用户"></a>创建nagios用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd nagios -d /usr/local/nagios</div></pre></td></tr></table></figure>
<h3 id="编译安装nagios"><a href="#编译安装nagios" class="headerlink" title="编译安装nagios"></a>编译安装nagios</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /opt/src</div><div class="line">tar xf nagios-4.2.4.tar.gz</div><div class="line">cd nagios-4.2.4</div><div class="line">./configure --prefix=/usr/local/nagios </div><div class="line">make all</div><div class="line">make install &amp;&amp; make install-init &amp;&amp; make install-commandmode &amp;&amp; make install-config</div></pre></td></tr></table></figure>
<p>把nagios添加为系统服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chkconfig --add nagios </div><div class="line">chkconfig nagios off</div><div class="line">chkconfig --level 35 nagios on</div><div class="line">chkconfig --list nagios</div></pre></td></tr></table></figure></p>
<h3 id="编译安装nagios插件（nagios-plugins）"><a href="#编译安装nagios插件（nagios-plugins）" class="headerlink" title="编译安装nagios插件（nagios-plugins）"></a>编译安装nagios插件（nagios-plugins）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /opt/src</div><div class="line">cd nagios-plugins-2.1.2</div><div class="line">./configure --prefix=/usr/local/nagios --with-nagios-user=nagios --with-nagios-group=nagios</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="安装FCGI使nginx支持"><a href="#安装FCGI使nginx支持" class="headerlink" title="安装FCGI使nginx支持"></a>安装FCGI使nginx支持</h3><h4 id="需要的包："><a href="#需要的包：" class="headerlink" title="需要的包："></a>需要的包：</h4><p>FCGI:<a href="http://www.cpan.org/modules/by-module/FCGI/FCGI-0.78.tar.gz" target="_blank" rel="external">http://www.cpan.org/modules/by-module/FCGI/FCGI-0.78.tar.gz</a><br>FCGI-ProcManager：<a href="http://www.cpan.org/modules/by-module/FCGI/FCGI-ProcManager-0.25.tar.gz" target="_blank" rel="external">http://www.cpan.org/modules/by-module/FCGI/FCGI-ProcManager-0.25.tar.gz</a><br>IO:<a href="http://www.cpan.org/authors/id/G/GB/GBARR/IO-1.25.tar.gz" target="_blank" rel="external">http://www.cpan.org/authors/id/G/GB/GBARR/IO-1.25.tar.gz</a><br>IO-All:<a href="http://www.cpan.org/authors/id/I/IN/INGY/IO-All-0.86.tar.gz" target="_blank" rel="external">http://www.cpan.org/authors/id/I/IN/INGY/IO-All-0.86.tar.gz</a></p>
<h4 id="编译安装步骤"><a href="#编译安装步骤" class="headerlink" title="编译安装步骤"></a>编译安装步骤</h4><p>分别解压并进入对应目录后执行（出错请检查上面的依赖（perl、perl-devel）是否安装）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">perl Makefile.PL </div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<h4 id="创建启动fcgi脚本"><a href="#创建启动fcgi脚本" class="headerlink" title="创建启动fcgi脚本"></a>创建启动fcgi脚本</h4><p>脚本下载地址：<a href="http://www.mike.org.cn/wp-content/uploads/2011/07/perl-fcgi.zip" target="_blank" rel="external">http://www.mike.org.cn/wp-content/uploads/2011/07/perl-fcgi.zip</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">vim /etc/nginx/start_perl_cgi.sh</div><div class="line">#!/bin/bash</div><div class="line">#set -x</div><div class="line">#此处根据情况修改</div><div class="line">dir=/etc/nginx</div><div class="line">stop ()</div><div class="line">&#123;</div><div class="line">#pkill  -f  $dir/perl-fcgi.pl</div><div class="line">kill -6 `cat $dir/logs/perl-fcgi.pid`</div><div class="line">rm $dir/logs/perl-fcgi.pid 2&gt;/dev/null</div><div class="line">rm $dir/logs/perl-fcgi.sock 2&gt;/dev/null</div><div class="line">echo &quot;stop perl-fcgi done&quot;</div><div class="line">&#125;</div><div class="line">start ()</div><div class="line">&#123;</div><div class="line">rm $dir/now_start_perl_fcgi.sh 2&gt;/dev/null</div><div class="line">#注意是否存在logs目录</div><div class="line">chown nagios.root $dir/logs</div><div class="line">echo &quot;$dir/perl-fcgi.pl -l $dir/logs/perl-fcgi.log -pid $dir/logs/perl-fcgi.pid -S $dir/logs/perl-fcgi.sock&quot; &gt;&gt;$dir/now_start_perl_fcgi.sh</div><div class="line">chown nagios.nagios $dir/now_start_perl_fcgi.sh</div><div class="line">chmod u+x $dir/now_start_perl_fcgi.sh</div><div class="line">sudo -u nagios $dir/now_start_perl_fcgi.sh</div><div class="line">echo &quot;start perl-fcgi done&quot;</div><div class="line">&#125;</div><div class="line">case $1 in</div><div class="line">stop)</div><div class="line">stop</div><div class="line">;;</div><div class="line">start)</div><div class="line">start</div><div class="line">;;</div><div class="line">restart)</div><div class="line">stop</div><div class="line">start</div><div class="line">;;</div><div class="line">esac</div></pre></td></tr></table></figure></p>
<h4 id="启动fcgi："><a href="#启动fcgi：" class="headerlink" title="启动fcgi："></a>启动fcgi：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/nginx/start_perl_cgi.sh start</div></pre></td></tr></table></figure>
<h4 id="确认进程是否存在"><a href="#确认进程是否存在" class="headerlink" title="确认进程是否存在"></a>确认进程是否存在</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ps aux | grep perl</div><div class="line">nagios   27125  0.0  0.7 138488  5668 pts/3    S    16:51   0:00 /usr/bin/perl /etc/nginx/perl-fcgi.pl -l /etc/nginx/logs/perl-fcgi.log -pid /etc/nginx/logs/perl-fcgi.pid -S /etc/nginx/logs/perl-fcgi.sock</div></pre></td></tr></table></figure>
<h3 id="安装php-fpm"><a href="#安装php-fpm" class="headerlink" title="安装php-fpm"></a>安装php-fpm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install php-fpm</div></pre></td></tr></table></figure>
<p>启动php-fpm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service php-fpm start</div></pre></td></tr></table></figure></p>
<h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">vim /etc/nginx/conf.d/nagios.conf </div><div class="line">server &#123;</div><div class="line">         listen       80;</div><div class="line">         server_name  nagios.linuxu.top;</div><div class="line">         root /usr/local/nagios/share;</div><div class="line">         index index.html index.php;</div><div class="line">         auth_basic &quot;admin&quot;;</div><div class="line">         auth_basic_user_file /etc/nginx/htpasswd;</div><div class="line">  location ~ .*\.php?$</div><div class="line">  &#123;</div><div class="line">    fastcgi_pass    127.0.0.1:9000;</div><div class="line">    fastcgi_index   index.php;</div><div class="line">    include fastcgi_params;</div><div class="line">    fastcgi_param SCRIPT_FILENAME /usr/local/nagios/share$fastcgi_script_name;</div><div class="line">  &#125;</div><div class="line">  location /nagios/</div><div class="line">  &#123;</div><div class="line">    gzip off;</div><div class="line">    alias /usr/local/nagios/share/;</div><div class="line">    index index.html index.htm index.php;</div><div class="line">  &#125;</div><div class="line">  location ~ \.cgi$ &#123;</div><div class="line">     rewrite ^/nagios/cgi-bin/(.*)\.cgi /$1.cgi break;</div><div class="line">     fastcgi_pass unix:/etc/nginx/logs/perl-fcgi.sock;</div><div class="line">     fastcgi_index index.cgi;</div><div class="line">     fastcgi_param SCRIPT_FILENAME /usr/local/nagios/sbin$fastcgi_script_name;</div><div class="line">     fastcgi_param HTTP_ACCEPT_LANGUAGE en_US;</div><div class="line">     include fastcgi_params;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="nginx-web验证帐号密码"><a href="#nginx-web验证帐号密码" class="headerlink" title="nginx web验证帐号密码"></a>nginx web验证帐号密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">htpasswd -c /etc/nginx/conf.d/htpasswd admin</div></pre></td></tr></table></figure>
<h4 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service nginx start</div></pre></td></tr></table></figure>
<h2 id="访问nagios-web界面"><a href="#访问nagios-web界面" class="headerlink" title="访问nagios web界面"></a>访问nagios web界面</h2><p><a href="http://nagios.linuxu.top/" target="_blank" rel="external">http://nagios.linuxu.top/</a><br><img src="http://i.imgur.com/ky6X4uo.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="徐立宝" />
          <p class="site-author-name" itemprop="name">徐立宝</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">徐立宝</span>
</div>


<div class="powered-by">
  <a class="theme-link" href="https://hexo.io">Hexo</a> Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
  
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("CzGbMSdtGPoTXKJpNzEsS0Ou-gzGzoHsz", "7JlNx7biktKStJ0mqU7qKBSz");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
